@use "../../styles/variables.scss" as *;

// Header specific theme variables
[data-theme="light"] {
  --header-nav-text: #000000;
}

[data-theme="dark"] {
  --header-nav-text: #ffffff;
}

// Scroll progress animation
@keyframes scrollProgress {
  0% {
    transform: translateX(-100%);
    opacity: 0;
  }
  50% {
    opacity: 1;
  }
  100% {
    transform: translateX(100%);
    opacity: 0;
  }
}

.header {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 1px solid rgba(99, 102, 241, 0.1);
  z-index: 1000;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  /* Use a CSS var for header height (includes mobile safe-area) */
  --header-height: calc(75px + env(safe-area-inset-top, 0px));

  &::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      135deg,
      rgba(99, 102, 241, 0.05) 0%,
      rgba(139, 92, 246, 0.05) 100%
    );
    pointer-events: none;
  }

  &--scrolled {
    backdrop-filter: blur(25px) saturate(200%);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(99, 102, 241, 0.1);

    &::before {
      background: linear-gradient(
        135deg,
        rgba(99, 102, 241, 0.08) 0%,
        rgba(139, 92, 246, 0.08) 100%
      );
    }
  }

  &--scrolling {
    &::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(99, 102, 241, 0.8) 50%,
        transparent 100%
      );
      animation: scrollProgress 0.8s ease-in-out infinite;
    }
  }

  &__container {
    @include flex-between;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 clamp(1.5rem, 5vw, 3rem);
    height: var(--header-height);
    position: relative;
    transition: all 0.3s ease;

    @media (min-width: $breakpoint-sm) {
      padding: 0 clamp(2rem, 6vw, 4rem);
    }

    /* When mobile menu is open, adjust layout */
    .header--menu-open & {
      justify-content: flex-end;

      @media (min-width: $breakpoint-md) {
        justify-content: space-between; // Keep normal layout on desktop
      }
    }
  }

  &__mobile-title {
    display: flex;
    align-items: center;
    opacity: 0;
    pointer-events: none;
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    z-index: 1;

    @media (min-width: $breakpoint-md) {
      display: none; // Hide on desktop
    }

    span {
      font-size: $font-lg;
      font-weight: $font-semibold;
      color: var(--text-primary);
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
  }

  &__actions {
    display: flex;
    align-items: center;
    gap: $spacing-base;
    margin-left: $spacing-lg;

    @media (max-width: $breakpoint-md) {
      display: none; // Hide on mobile since theme toggle is in menu
    }
  }

  &__theme-toggle {
    @include flex-center;
    width: 44px;
    height: 44px;
    background: color-mix(in oklab, var(--bg-secondary) 80%, transparent);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    color: var(--text-primary);
    font-size: $font-lg;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        135deg,
        rgba(99, 102, 241, 0.1) 0%,
        rgba(139, 92, 246, 0.1) 100%
      );
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    &:hover {
      background: color-mix(in oklab, var(--primary-light) 15%, var(--bg-secondary));
      border-color: color-mix(in oklab, var(--primary-light) 40%, var(--border-color));
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);

      &::before {
        opacity: 1;
      }
    }

    svg {
      position: relative;
      z-index: 1;
      transition: color 0.3s ease;
    }

    &:focus-visible {
      outline: 2px solid color-mix(in oklab, var(--primary-light) 60%, transparent);
      outline-offset: 2px;
    }
  }

  &__mobile-theme-toggle {
  width: auto;
  padding: 0 1.5rem 0.75rem;
  margin: 0;
  display: flex;
  justify-content: center;
  }

  &__nav-item--theme {
  margin-top: auto;
  padding-top: 1rem;
    border-top: 1px solid color-mix(in oklab, var(--border-color) 40%, transparent);
    position: relative;

    &::before {
      content: '';
      position: absolute;
      top: 0;
  left: 1.5rem;
  right: 1.5rem;
      height: 1px;
      background: linear-gradient(
        90deg,
        transparent 0%,
        color-mix(in oklab, var(--primary-light) 30%, transparent) 50%,
        transparent 100%
      );
    }
  }

  &__logo-link {
    text-decoration: none;
    color: inherit;
    display: flex;
    border-radius: 20px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    
    &:focus-visible {
      outline: 2px solid color-mix(in oklab, var(--primary-light) 60%, transparent);
      outline-offset: 3px;
    }

    &:hover {
      .header__logo {
        transform: translateY(-1px);
      }
    }

    &:active {
      .header__logo {
        transform: translateY(0px);
      }
    }
  }

  &__logo {
    display: flex;
    align-items: center;
    gap: 1.25rem;
    cursor: pointer;
    user-select: none;
    padding: 0.875rem 1rem;
    border-radius: 20px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    pointer-events: auto;

    /* Hide logo completely when mobile menu is open */
    &.header__logo--hidden {
      opacity: 0;
      pointer-events: none;
      transform: translateX(-30px) scale(0.9);
    }

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        135deg,
        rgba(99, 102, 241, 0.1) 0%,
        rgba(139, 92, 246, 0.1) 100%
      );
      border-radius: 16px;
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    &:hover {
      transform: translateY(-1px);
      
      &::before {
        opacity: 1;
        background: linear-gradient(
          135deg,
          rgba(99, 102, 241, 0.15) 0%,
          rgba(139, 92, 246, 0.15) 100%
        );
      }
    }

    &:active {
      transform: translateY(0px);
      
      &::before {
        opacity: 1;
        background: linear-gradient(
          135deg,
          rgba(99, 102, 241, 0.2) 0%,
          rgba(139, 92, 246, 0.2) 100%
        );
      }
    }

    &-container {
      position: relative;
      z-index: 1;
    }

    &-gradient {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      padding: 2px;
      border-radius: 50%;
      position: relative;
    }

    &-icon {
      width: clamp(50px, 8vw, 60px);
      height: clamp(50px, 8vw, 60px);
      background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-secondary) 100%);
      border-radius: 50%;
      @include flex-center;
      font-weight: $font-bold;
      font-size: clamp(1rem, 3vw, 1.25rem);
      color: var(--text-primary);
      position: relative;
      overflow: hidden;
      border: 2px solid var(--border-color);

      &::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          45deg,
          transparent 30%,
          rgba(255, 255, 255, 0.2) 50%,
          transparent 70%
        );
        transform: translateX(-100%);
        transition: transform 0.6s ease;
      }

      &:hover::before {
        transform: translateX(100%);
      }

      span {
        position: relative;
        z-index: 1;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
    }

    &-text {
      display: flex;
      flex-direction: column;
      align-items: flex-start;

      @media (max-width: $breakpoint-sm) {
        display: none;
      }
    }

    &-name {
      font-size: clamp(1.125rem, 3vw, 1.375rem);
      font-weight: $font-bold;
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1.2;
      margin-bottom: 2px;
    }

    &-title {
      font-size: clamp(0.75rem, 2.5vw, 0.875rem);
      color: var(--text-tertiary);
      font-weight: $font-medium;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
  }

  &__nav {
    &--desktop {
      display: none;

      @media (min-width: $breakpoint-md) {
        display: block;
      }
    }

    &--mobile {
      position: fixed;
      top: var(--header-height);
      right: 0;
      left: auto;
      width: clamp(320px, 85vw, 380px); /* Responsive width for better UX */
      height: calc(100vh - var(--header-height));
      /* Enhanced background with better theming */
      background: color-mix(in oklab, var(--bg-primary) 95%, transparent);
      backdrop-filter: blur(35px) saturate(200%);
      border-left: 1px solid var(--border-color);
      padding: 1.5rem 0 1.25rem;
  display: flex;
  flex-direction: column;
  overflow: hidden; /* inner list will scroll */
      z-index: 1001; // ensure menu is above everything
      box-shadow: -4px 0 24px rgba(0, 0, 0, 0.15);

      /* Dark mode specific enhancements */
      [data-theme="dark"] & {
        background: color-mix(in oklab, var(--bg-primary) 95%, transparent);
        border-left-color: color-mix(in oklab, var(--border-color) 80%, transparent);
        box-shadow: -4px 0 32px rgba(0, 0, 0, 0.4);
      }

      /* Light mode specific enhancements */
      [data-theme="light"] & {
        background: color-mix(in oklab, var(--bg-primary) 98%, transparent);
        border-left-color: var(--border-color);
        box-shadow: -4px 0 24px rgba(0, 0, 0, 0.08);
      }

      &::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        /* Theme-aware gradient overlay */
        background: linear-gradient(
          180deg,
          color-mix(in oklab, var(--primary-light) 5%, transparent) 0%,
          transparent 20%,
          transparent 80%,
          color-mix(in oklab, var(--primary-light) 3%, transparent) 100%
        );
        pointer-events: none;
      }
    }

    &-mobile-header {
      padding: 1.5rem calc(2rem + env(safe-area-inset-right, 0px)) 1.5rem
        calc(2rem + env(safe-area-inset-left, 0px));
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 1.5rem;
      background: linear-gradient(
        135deg,
        color-mix(in oklab, var(--bg-secondary) 40%, transparent) 0%,
        color-mix(in oklab, var(--bg-tertiary) 30%, transparent) 100%
      );
      backdrop-filter: blur(15px);
      position: relative;
      
      &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--gradient-primary);
        opacity: 0.8;
      }
      
      &::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 2rem;
        right: 2rem;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent 0%,
          var(--border-color) 20%,
          var(--border-color) 80%,
          transparent 100%
        );
      }
    }

    &-mobile-title {
      font-size: $font-xl;
      font-weight: $font-bold;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      
      &::before {
        content: '✨';
        font-size: $font-base;
        filter: drop-shadow(0 0 4px rgba(99, 102, 241, 0.4));
      }
    }

    &-mobile-subtitle {
      font-size: $font-sm;
      color: var(--text-secondary);
      font-weight: $font-medium;
      opacity: 0.8;
      letter-spacing: 0.25px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      
      &::before {
        content: '👆';
        font-size: $font-sm;
      }
    }

    &-list {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      list-style: none;

      &--mobile {
        flex-direction: column;
        align-items: stretch;
        gap: 0.5rem;
        padding: 0 calc(1.5rem + env(safe-area-inset-right, 0px))
          0 calc(1.5rem + env(safe-area-inset-left, 0px));
        
        /* Add subtle background pattern */
        position: relative;
        
        &::before {
          content: '';
          position: absolute;
          top: -1rem;
          left: 1.5rem;
          right: 1.5rem;
          bottom: -1rem;
          background: 
            radial-gradient(circle at 20% 20%, color-mix(in oklab, var(--primary-light) 3%, transparent) 0%, transparent 50%),
            radial-gradient(circle at 80% 80%, color-mix(in oklab, var(--accent-primary) 3%, transparent) 0%, transparent 50%);
          border-radius: 1rem;
          pointer-events: none;
          opacity: 0.6;
        }
      }
    }

    &-item {
      position: relative;
    }

    &-link {
      @include flex-center;
      gap: 0.875rem;
      padding: 0.875rem 1.5rem;
      background: none;
      border: none;
      border-radius: 16px;
      color: var(--text-secondary);
      font-size: clamp(0.875rem, 2.5vw, 0.95rem);
      font-weight: $font-medium;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      white-space: nowrap;

      @media (min-width: $breakpoint-lg) {
        padding: 0.875rem 1.75rem;
        font-size: clamp(0.95rem, 2.5vw, 1rem);
        gap: 1rem;
      }

      .header__nav--mobile & {
        width: 100%;
        justify-content: flex-start;
        padding: 1rem 1.25rem;
        border-radius: 12px;
        margin-bottom: 0.25rem;
        border: 1px solid var(--border-color);
        background: color-mix(in oklab, var(--bg-secondary) 40%, transparent);
        color: var(--text-primary);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

        /* Dark mode specific styling */
        [data-theme="dark"] & {
          background: color-mix(in oklab, var(--bg-secondary) 25%, transparent);
          border-color: color-mix(in oklab, var(--border-color) 60%, transparent);
        }

        /* Light mode specific styling */
        [data-theme="light"] & {
          background: color-mix(in oklab, var(--bg-secondary) 60%, transparent);
          border-color: var(--border-color);
        }
      }

      &::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          rgba(99, 102, 241, 0.1) 0%,
          rgba(139, 92, 246, 0.1) 100%
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      &:hover {
        color: var(--text-primary);
        background: color-mix(in oklab, var(--primary-light) 12%, var(--bg-secondary));
        transform: translateY(-1px);
        border-color: color-mix(in oklab, var(--primary-light) 30%, var(--border-color));

        &::before {
          opacity: 1;
        }

        .header__nav-icon {
          color: var(--primary-light);
          transform: scale(1.1);
        }

        /* Dark mode hover */
        [data-theme="dark"] & {
          background: color-mix(in oklab, var(--primary-light) 8%, var(--bg-secondary));
          color: var(--text-primary);
        }

        /* Light mode hover */
        [data-theme="light"] & {
          background: color-mix(in oklab, var(--primary-light) 15%, var(--bg-secondary));
          color: var(--text-primary);
        }
      }

      &--active {
        color: var(--text-primary);
        background: linear-gradient(
          135deg,
          color-mix(in oklab, var(--primary-light) 15%, transparent) 0%,
          color-mix(in oklab, var(--accent-primary) 15%, transparent) 100%
        );
        border: 1px solid color-mix(in oklab, var(--primary-light) 40%, var(--border-color));

        .header__nav-icon {
          color: var(--primary-light);
        }

        &::before {
          opacity: 1;
        }

        /* Dark mode active */
        [data-theme="dark"] & {
          background: linear-gradient(
            135deg,
            color-mix(in oklab, var(--primary-light) 12%, transparent) 0%,
            color-mix(in oklab, var(--accent-primary) 12%, transparent) 100%
          );
        }

        /* Light mode active */
        [data-theme="light"] & {
          background: linear-gradient(
            135deg,
            color-mix(in oklab, var(--primary-light) 18%, transparent) 0%,
            color-mix(in oklab, var(--accent-primary) 18%, transparent) 100%
          );
        }
      }
    }

    &-icon-container {
      position: relative;
      z-index: 1;
    }

    &-icon {
      font-size: clamp(1rem, 3vw, 1.125rem);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      z-index: 1;

      @media (min-width: $breakpoint-lg) {
        font-size: clamp(1.125rem, 3vw, 1.25rem);
      }
    }

    &-text {
      position: relative;
      z-index: 1;
  /* Inherit color so mobile + dark mode use the correct tone */
  color: inherit;
    }

    // Ensure hover/active states still apply highlight color
    .header__nav-link:hover .header__nav-text,
    .header__nav-link--active .header__nav-text {
      color: #3a9dff;
    }

    &-indicator {
      position: absolute;
      bottom: 2px; // keep dot closer under the active pill
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 6px;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
      pointer-events: none;
    }

    &-glow {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        135deg,
        rgba(99, 102, 241, 0.2) 0%,
        rgba(139, 92, 246, 0.2) 100%
      );
      border-radius: 12px;
      pointer-events: none;
    }

    &-active-dot {
      width: 6px;
      height: 6px;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border-radius: 50%;
      margin-left: auto;
      box-shadow: 0 0 8px rgba(99, 102, 241, 0.6);
    }
  }

  &__menu-toggle {
    @include flex-center;
    width: clamp(52px, 10vw, 58px);
    height: clamp(52px, 10vw, 58px);
    /* Themed frosted button for mobile */
    background: color-mix(in oklab, var(--bg-secondary) 75%, transparent);
    border: 1px solid var(--border-color);
    border-radius: 18px;
    color: var(--text-primary);
    font-size: clamp(1.25rem, 4vw, 1.375rem);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    z-index: 1002; // Higher than menu to ensure it stays clickable
    backdrop-filter: blur(15px);
    /* Prevent clipping near notches on mobile */
    margin-right: env(safe-area-inset-right, 0px);
    margin-left: auto; // Push to right when logo is hidden

    @media (min-width: $breakpoint-md) {
      display: none;
    }

    &:hover {
      background: color-mix(in oklab, var(--primary-light) 14%, var(--bg-secondary));
      border-color: color-mix(in oklab, var(--primary-light) 45%, var(--border-color));
      transform: scale(1.05);
    }

    &--open {
      background: color-mix(in oklab, var(--primary-light) 22%, var(--bg-secondary));
      border-color: color-mix(in oklab, var(--primary-light) 55%, var(--border-color));
      color: var(--primary-light);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
    }

    &:focus-visible {
      outline: 2px solid color-mix(in oklab, var(--primary-light) 60%, transparent);
      outline-offset: 2px;
    }
  }

  &__overlay {
    position: fixed;
    top: var(--header-height);
    left: 0;
    width: 100%;
    height: calc(100vh - var(--header-height));
    background: rgba(0, 0, 0, 0.4);
    z-index: 1000;
    backdrop-filter: blur(2px);

    /* Dark mode overlay */
    [data-theme="dark"] & {
      background: rgba(0, 0, 0, 0.6);
    }

    /* Light mode overlay */
    [data-theme="light"] & {
      background: rgba(0, 0, 0, 0.3);
    }
  }
}

// Smooth scroll padding to account for fixed header
html {
  /* Will be overridden on mobile below; keep generous default */
  scroll-padding-top: calc(var(--header-height) + 40px);
}

// Enhanced mobile experience
@media (max-width: $breakpoint-md) {
  .header {
    &__container {
  
      height: var(--header-height);
  padding: 0 1rem;
    }

    &__nav--mobile {

      top: var(--header-height);
      height: calc(100vh - var(--header-height));
      left: 0;
      right: 0;
      width: 100vw; /* full width on mobile */
      max-width: none; /* remove constraint */
      border-left: none; /* no divider when full width */
      z-index: 1000; // keep above overlay on small screens
    }

    &__overlay {
      top: var(--header-height);
      height: calc(100vh - var(--header-height));
    }

    &__logo {
      padding: 0.5rem;

      &-icon {
        width: 40px;
        height: 40px;
        font-size: 1rem;
      }

      &-name {
        font-size: 1.125rem;
      }

      &-title {
        font-size: 0.6875rem;
      }
    }
  }

  html {
    scroll-padding-top: calc(var(--header-height) + 30px);
  }
}

// High contrast mode support
@media (prefers-contrast: high) {
  .header {
    border-bottom-width: 2px;

    &__nav-link {
      border: 1px solid transparent;

      &:hover,
      &--active {
        border-color: var(--primary-light);
      }
    }
  }
}

// Reduced motion support
@media (prefers-reduced-motion: reduce) {
  .header {
    &__logo-dot {
      animation: none;
    }

    &__nav-link::before {
      display: none;
    }
  }
}
